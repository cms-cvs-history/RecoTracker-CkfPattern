process CkfPattern = 
{
  ### keep the logging output to a nice level ###
  include "FWCore/MessageLogger/data/MessageLogger.cfi"
	 
  ### initialize magnetic field ###
  include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"

  ### initialize idealGeometry ###
  es_source = XMLIdealGeometryESSource 
  { 
    # tracker geometry
    FileInPath GeometryConfiguration = "Geometry/TrackerSimData/data/trackerSimConfiguration.xml"

    # the proper root node is set in the xml file
    string rootNodeName = ""
  }

  ### tracker numbering ###
  include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"

  ### tracker geometry ###
  include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"

  ### StripCPEfromTrackAngleESProducer es_module
  include "RecoLocalTracker/SiStripRecHitConverter/data/StripCPEfromTrackAngle.cfi"


  ### Pixel Clusterizer and RecHit producer modules
  include "RecoLocalTracker/SiPixelClusterizer/data/SiPixelClusterizer.cfi"
  include "RecoLocalTracker/SiPixelRecHits/data/SiPixelRecHits.cfi" 

  ### SiliconStrip Clusterizer and RecHit producer modules
  include "RecoLocalTracker/SiStripClusterizer/data/SiStripClusterizer.cfi"
  include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitConverter.cfi"


  ### TrackerRecoGeometry ###
  include "RecoTracker/TkDetLayers/data/trackerRecoGeometry.cfi"

  ### GlobalPixelSeedGenerator module ###
  include "RecoTracker/TkSeedGenerator/data/GlobalPixelSeedGenerator.cfi"

  ### updator, measurementEstimator, propagator es_modules ###	
  es_module = KFUpdatorESProducer
  {
    string ComponentName = "KFUpdator"   
  }

  es_module = Chi2MeasurementEstimatorESProducer
  {
    string ComponentName = "Chi2"   
    double MaxChi2 = 30. 
    double nSigma = 3.
  }

  es_module mat1 = PropagatorWithMaterialESProducer {
    string ComponentName = "PropagatorWithMaterial"
    string PropagationDirection = "alongMomentum"	
    double Mass = 0.105
  }

  es_module mat2 = PropagatorWithMaterialESProducer {
    string ComponentName = "PropagatorWithMaterialOpposite"
    string PropagationDirection = "oppositeToMomentum"	
    double Mass = 0.105
  }
  
  ### KFTrackCandidateMaker module. 
  #   At the moment it uses only the CombinatorialTrajectoryBuilder ###
  include "RecoTracker/CkfPattern/data/CombinatorialTrajectoryBuilder.cfi"


  source = PoolSource 
  { 
    untracked vstring fileNames = {'file:digis.root'}
    untracked int32 maxEvents = -1
  }


  module out = PoolOutputModule 
  {
    untracked string fileName = 'digisToCands.root'
  }

  path p = 
  {
    pixClust,pixRecHitConverter, ThreeThresholdClusterizer,LocalMeasurementConverter,
    seedGenerator,trackCandidateMaker
  }

  endpath e = 
  {
    out
  }
}
